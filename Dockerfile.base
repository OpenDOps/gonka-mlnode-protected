FROM ghcr.io/product-science/mlnode:3.0.11-post1@sha256:0cf224b2f88694def989731ecdd23950a6d899be5d70e01e8dcf823b906199af

# Install nginx, pkg-config and wireguard userspace tools (without resolvconf)
RUN apt update && \
    apt install -y --no-install-recommends nginx nano wget pkg-config curl && \
    apt clean && \
    rm -rf /var/lib/apt/lists/*

# Install FRP client (frpc)
ARG FRP_VERSION=0.65.0
RUN mkdir -p /tmp/frp && \
    cd /tmp/frp && \
    wget -q "https://github.com/fatedier/frp/releases/download/v${FRP_VERSION}/frp_${FRP_VERSION}_linux_amd64.tar.gz" && \
    tar -xzf "frp_${FRP_VERSION}_linux_amd64.tar.gz" && \
    install -m 0755 "frp_${FRP_VERSION}_linux_amd64/frpc" /usr/bin/frpc && \
    rm -rf /tmp/frp

COPY model-weigths-download.sh /data/model-weigths-download.sh

# Configure nginx (single container version)
COPY nginx-single.conf /etc/nginx/nginx.conf

ENV HF_HOME=/data/hf-cache
ENV MODEL_NAME=Qwen/Qwen3-32B-FP8

WORKDIR /app

